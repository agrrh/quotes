---

version: '3'

tasks:
  init:
    preconditions:
      - pip --version
    cmds:
      # TODO: Add apk cache proxy?
      - apk update
      - apk install gcc musl-dev
      # TODO: Add pip cache proxy?
      - pip install -r requirements.txt
      - pip install -r requirements.ci.txt

  lint:flake8:
    deps:
      - init
    preconditions:
      - flake8 --version
    cmds:
      - flake8 ./backend

  lint:black:
    deps:
      - init
    preconditions:
      - black --version
    cmds:
      - black --check --diff ./backend

  lint:
    deps:
      - lint:flake8
      - lint:black

  test:
    preconditions:
      - python --version
    deps:
      - init
    cmds:
      - pytest backend/tests
